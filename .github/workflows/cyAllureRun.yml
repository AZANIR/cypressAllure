name: Cypress Tests using Cypress Docker Image with allure-report

on:
    push:
        branches: [master]

jobs:
    cypress-run:
        name: Cypress run
        runs-on: ubuntu-20.04
        steps:
            - name: Checkout
              uses: actions/checkout@v2

            - name: Cypress run
              uses: cypress-io/github-action@v4
              with:
                  config-file: config/config.config.ts
              if: always()
            - run: npm run allure:generate
            - name: Upload artifact allure-report
              uses: actions/upload-artifact@v1
              if: always()
              with:
                  name: allure-report
                  path: ./allure-report
            - name: Deploy report
              uses: JamesIves/github-pages-deploy-action@3.1.0
              if: always()
              with:
                  ACCESS_TOKEN: ${{'secrets.ACCESS_TOKEN'}}
                  BRANCH: master # The branch the action should deploy to.
                  FOLDER: allure-report # The folder the action should deploy.
                  TARGET_FOLDER: docs # The folder the action should deploy to.
